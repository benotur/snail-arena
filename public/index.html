<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snail Arena</title>
    <link rel="stylesheet" href="styles/main.css">
        <!-- Firebase App (the core Firebase SDK) -->
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
        <!-- Firebase Realtime Database -->
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
    <div id="alert-container"></div>
    <!-- Challenge Window (hidden by default, opened by button) -->
    <div id="challenge-window" style="display:none;position:fixed;top:50%;left:32px;transform:translateY(-50%);z-index:210;background:rgba(20,20,20,0.98);border-radius:18px;padding:24px 32px;box-shadow:0 4px 24px #000;max-width:340px;min-width:220px;max-height:70vh;overflow-y:auto;">
        <div style="font-size:22px;font-weight:bold;color:#ffd700;margin-bottom:12px;text-align:center;">Challenges</div>
        <div id="dailyChallenge" class="info" style="margin-bottom:18px;"></div>
        <div id="weeklyChallenge" class="info"></div>
        <button id="close-challenge-window" style="margin-top:18px;padding:7px 18px;border-radius:8px;background:#222;color:#ffd700;font-size:15px;border:none;cursor:pointer;">Close</button>
    </div>
    <!-- Challenges Button (icon only) -->
    <button id="open-challenge-window" style="position:fixed;top:24px;right:24px;z-index:252;padding:12px 18px;border-radius:50px;background:#222;color:#ffd700;font-size:22px;border:none;cursor:pointer;pointer-events:auto;display:inline-flex;align-items:center;gap:8px;margin-bottom:8px;">
        üèÜ
    </button>
    <!-- Username Input (hidden by default) -->
    <div id="username-container" style="position:fixed;top:10px;right:50%;transform:translateX(50%);z-index:200;background:#222;padding:10px 20px;border-radius:8px;box-shadow:0 0 8px #4caf50;display:none;">
            <label for="username-input" style="color:#fff;font-family:inherit;font-size:15px;">Username:</label>
            <input id="username-input" type="text" style="font-size:15px;padding:4px 10px;border-radius:4px;border:1px solid #4caf50;">
            <button id="username-confirm" style="font-size:15px;padding:4px 12px;border-radius:4px;border:1px solid #4caf50;background:#4caf50;color:#222;cursor:pointer;">OK</button>
        </div>
    <!-- Mutation Book Menu (integrated, same style as Hazard Book) -->
    <div id="mutation-book-menu" style="position:fixed;top:50px;right:50px;z-index:301;background:rgba(20,20,20,0.98);border-radius:18px;padding:24px 32px;box-shadow:0 4px 24px #000;display:none;max-width:340px;min-width:220px;max-height:70vh;overflow-y:auto;">
    <div style="font-size:22px;font-weight:bold;color:#ffd700;margin-bottom:12px;text-align:center;">Mutation Book</div>
    <div style="font-size:13px;color:#fff;margin-bottom:14px;text-align:center;line-height:1.4;">Unlock mutations by progressing in prestige, surviving hazards, reaching slime milestones, or through rare events and daily challenges.</div>
    <div id="mutation-book-list" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px 14px;"></div>
    <button id="close-mutation-book" style="margin-top:18px;padding:7px 18px;border-radius:8px;background:#222;color:#ffd700;font-size:15px;border:none;cursor:pointer;">Close</button>
    </div>
    <!-- Mutation Book Button (icon only) -->
    <button id="open-mutation-book" style="position:fixed;top:72px;right:24px;z-index:251;padding:12px 18px;border-radius:50px;background:#222;color:#ffd700;font-size:22px;border:none;cursor:pointer;pointer-events:auto;margin-bottom:8px;display:inline-flex;align-items:center;gap:8px;">
        üß¨
    </button>
    <!-- Hazard Book Menu -->
    <div id="hazard-book-menu" style="position:fixed;top:50px;right:50px;z-index:300;background:rgba(20,20,20,0.98);border-radius:18px;padding:24px 32px;box-shadow:0 4px 24px #000;display:none;max-width:340px;min-width:220px;">
        <div style="font-size:22px;font-weight:bold;color:#ffd700;margin-bottom:12px;text-align:center;">Hazard Book</div>
        <div id="hazard-book-list"></div>
        <button id="close-hazard-book" style="margin-top:18px;padding:7px 18px;border-radius:8px;background:#222;color:#ffd700;font-size:15px;border:none;cursor:pointer;">Close</button>
    </div>
    <!-- Hazard Book Button (icon only) -->
    <button id="open-hazard-book" style="position:fixed;top:120px;right:24px;z-index:250;padding:12px 18px;border-radius:50px;background:#222;color:#ffd700;font-size:22px;border:none;cursor:pointer;margin-bottom:8px;display:inline-flex;align-items:center;gap:8px;">
        ‚ö†Ô∏è
    </button>
    <script>
    // Mutation Book logic (calls game.js function)
    window.addEventListener('DOMContentLoaded', function() {
        const mutationBookBtn = document.getElementById('open-mutation-book');
        const closeMutationBookBtn = document.getElementById('close-mutation-book');
        mutationBookBtn.onclick = function() {
            if (window.showMutationBook) window.showMutationBook();
        };
        closeMutationBookBtn.onclick = function() {
            document.getElementById('mutation-book-menu').style.display = 'none';
        };
        // Challenge window open/close logic
        document.getElementById('open-challenge-window').onclick = function() {
            document.getElementById('challenge-window').style.display = 'block';
        };
        document.getElementById('close-challenge-window').onclick = function() {
            document.getElementById('challenge-window').style.display = 'none';
        };
    });
    </script>
    <div id="ui-container">
        <div id="score-panel">
            <div id="distance" class="score">Distance: 0 m</div>
            <div id="slimePoints" class="score">Slime: 0</div>
            <div id="checkpoint" class="score">Checkpoint: Garden</div>
            <div id="prestige" class="score">Prestige: 0</div>
            <!-- Hazard timer moved here -->
            <div id="hazard-timer" class="info" style="margin-top:8px;"></div>
        </div>
        <div id="upgrade-panel">
            <button id="speedShell" class="upgrade-btn">üêö <span class="upgrade-name">Speed Shell</span><span class="upgrade-cost"></span></button>
            <button id="slimeBooster" class="upgrade-btn">üß™ <span class="upgrade-name">Slime Booster</span><span class="upgrade-cost"></span></button>
            <button id="turboSlime" class="upgrade-btn">‚ö° <span class="upgrade-name">Turbo Slime</span><span class="upgrade-cost"></span></button>
        </div>
        <button id="prestigeBtn" class="prestige-btn" style="display:inline-flex;align-items:center;gap:8px;">
            ü¶ë <span class="prestige-name">Prestige: New Species</span>
            <span class="prestige-cost"></span>
            <span class="prestige-level"></span>
        </button>
    </div>
    <div id="leaderboard-box">
        <div id="leaderboard-title"><b>Leaderboard</b></div>
        <div id="leaderboard-list">Loading...</div>
        <div id="leaderboard-refresh">Refresh in <span id="leaderboard-timer">10</span>s</div>
    </div>
    <!-- Leaderboard Modal/Menu for mobile -->
    <div id="leaderboard-menu" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999;background:rgba(20,20,20,0.98);border-radius:18px;padding:24px 32px;box-shadow:0 4px 24px #000;max-width:340px;min-width:180px;max-height:70vh;overflow-y:auto;">
        <div style="font-size:22px;font-weight:bold;color:#ffd700;margin-bottom:12px;text-align:center;">Leaderboard</div>
        <div id="leaderboard-menu-list" style="margin-bottom:12px;">Loading...</div>
        <button id="close-leaderboard-menu" style="margin-top:18px;padding:7px 18px;border-radius:8px;background:#222;color:#ffd700;font-size:15px;border:none;cursor:pointer;">Close</button>
    </div>
    <canvas id="gameCanvas"></canvas>
    <script src="scripts/game.js"></script>
    <script>
    // Mutation Book logic (calls game.js function)
    window.addEventListener('DOMContentLoaded', function() {
        const mutationBookBtn = document.getElementById('open-mutation-book');
        const closeMutationBookBtn = document.getElementById('close-mutation-book');
        mutationBookBtn.onclick = function() {
            if (window.showMutationBook) window.showMutationBook();
        };
        closeMutationBookBtn.onclick = function() {
            document.getElementById('mutation-book-menu').style.display = 'none';
        };
        // Challenge window open/close logic
        document.getElementById('open-challenge-window').onclick = function() {
            document.getElementById('challenge-window').style.display = 'block';
        };
        document.getElementById('close-challenge-window').onclick = function() {
            document.getElementById('challenge-window').style.display = 'none';
        };
        // Leaderboard menu logic for mobile
        function isMobile() {
            return window.innerWidth <= 600;
        }
        const leaderboardBox = document.getElementById('leaderboard-box');
        const leaderboardMenu = document.getElementById('leaderboard-menu');
        const leaderboardMenuList = document.getElementById('leaderboard-menu-list');
        const closeLeaderboardMenuBtn = document.getElementById('close-leaderboard-menu');
        if (leaderboardBox && leaderboardMenu && leaderboardMenuList && closeLeaderboardMenuBtn) {
            leaderboardBox.onclick = function() {
                if (isMobile()) {
                    // Copy leaderboard content
                    leaderboardMenuList.innerHTML = document.getElementById('leaderboard-list').innerHTML;
                    leaderboardMenu.style.display = 'block';
                }
            };
            closeLeaderboardMenuBtn.onclick = function() {
                leaderboardMenu.style.display = 'none';
            };
        }
    });
    </script>
</body>
</html>